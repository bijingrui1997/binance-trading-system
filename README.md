# å¸å®‰é‡åŒ–äº¤æ˜“ç³»ç»Ÿ - å†å²æ•°æ®æ¨¡å—

è¿™æ˜¯ä¸€ä¸ªåŸºäºå¸å®‰APIçš„é‡åŒ–äº¤æ˜“ç³»ç»Ÿçš„ç¬¬ä¸€ç‰ˆï¼Œä¸“æ³¨äºå†å²æ•°æ®çš„ä¸‹è½½ã€å­˜å‚¨å’Œè¯»å–åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸš€ æ ¸å¿ƒåŠŸèƒ½
- **å¤šæ•°æ®ç±»å‹æ”¯æŒ**: Kçº¿æ•°æ®(klines)ã€äº¤æ˜“æ•°æ®(trades)ã€èšåˆäº¤æ˜“æ•°æ®(aggTrades)
- **å¤šå¸‚åœºæ”¯æŒ**: ç°è´§(spot)ã€USD-MæœŸè´§(um)ã€COIN-MæœŸè´§(cm)
- **çµæ´»æ—¶é—´èŒƒå›´**: æ”¯æŒæŒ‡å®šå¼€å§‹å’Œç»“æŸæ—¥æœŸçš„æ•°æ®ä¸‹è½½
- **å¤šäº¤æ˜“å¯¹**: æ”¯æŒæ‰¹é‡ä¸‹è½½å¤šä¸ªäº¤æ˜“å¯¹çš„æ•°æ®
- **æ™ºèƒ½å­˜å‚¨**: è‡ªåŠ¨ç»„ç»‡æ–‡ä»¶ç»“æ„ï¼Œæ”¯æŒæœˆåº¦å’Œæ—¥åº¦æ•°æ®
- **é¡ºåºè¯»å–**: æ”¯æŒæŒ‰æ—¶é—´é¡ºåºè¯»å–æŒ‡å®šèŒƒå›´çš„å†å²æ•°æ®
- **åˆ†å—å¤„ç†**: æ”¯æŒå¤§æ•°æ®é›†çš„åˆ†å—è¯»å–ï¼ŒèŠ‚çœå†…å­˜

### ğŸ“Š æ•°æ®ç±»å‹
- **Kçº¿æ•°æ®**: 1s, 1m, 3m, 5m, 15m, 30m, 1h, 2h, 4h, 6h, 8h, 12h, 1d, 3d, 1w, 1M
- **äº¤æ˜“æ•°æ®**: å®Œæ•´çš„äº¤æ˜“è®°å½•
- **èšåˆäº¤æ˜“æ•°æ®**: èšåˆçš„äº¤æ˜“æ•°æ®

### ğŸ›  å®ç”¨å·¥å…·
- **æ•°æ®ä¿¡æ¯æŸ¥è¯¢**: æŸ¥çœ‹æœ¬åœ°æ•°æ®çš„ç»Ÿè®¡ä¿¡æ¯
- **å­˜å‚¨ç®¡ç†**: æŸ¥çœ‹å­˜å‚¨ä½¿ç”¨æƒ…å†µ
- **æ•°æ®æ¸…ç†**: æ¸…ç†è¿‡æœŸçš„å†å²æ•°æ®

## å®‰è£…è¯´æ˜

### ç¯å¢ƒè¦æ±‚
- Python 3.8+
- ç½‘ç»œè¿æ¥ï¼ˆç”¨äºä¸‹è½½æ•°æ®ï¼‰

### å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

### ä¾èµ–åŒ…è¯´æ˜
- `requests`: HTTPè¯·æ±‚åº“ï¼Œç”¨äºæ•°æ®ä¸‹è½½
- `pandas`: æ•°æ®å¤„ç†å’Œåˆ†æ
- `numpy`: æ•°å€¼è®¡ç®—
- `python-dateutil`: æ—¥æœŸå¤„ç†
- `tqdm`: è¿›åº¦æ¡æ˜¾ç¤º
- `pytest`: æµ‹è¯•æ¡†æ¶

## å¿«é€Ÿå¼€å§‹

### åŸºç¡€ä½¿ç”¨

```python
from historical_data_manager import HistoricalDataManager

# åˆå§‹åŒ–æ•°æ®ç®¡ç†å™¨
manager = HistoricalDataManager()

# ä¸‹è½½BTCUSDTçš„1å°æ—¶Kçº¿æ•°æ®
manager.download_data(
    symbols=["BTCUSDT"],
    market_type="spot",
    data_type="klines",
    interval="1h",
    start_date="2024-01-01",
    end_date="2024-01-31"
)

# è¯»å–æ•°æ®
df = manager.read_data(
    symbol="BTCUSDT",
    market_type="spot",
    data_type="klines",
    interval="1h",
    start_date="2024-01-01",
    end_date="2024-01-31"
)

print(f"æ•°æ®å½¢çŠ¶: {df.shape}")
print(df.head())
```

### æ‰¹é‡ä¸‹è½½å¤šä¸ªäº¤æ˜“å¯¹

```python
# ä¸‹è½½å¤šä¸ªäº¤æ˜“å¯¹
symbols = ["BTCUSDT", "ETHUSDT", "BNBUSDT"]
manager.download_data(
    symbols=symbols,
    market_type="spot",
    data_type="klines",
    interval="4h",
    start_date="2024-01-01",
    end_date="2024-01-07"
)

# è¯»å–æ¯ä¸ªäº¤æ˜“å¯¹çš„æ•°æ®
for symbol in symbols:
    df = manager.read_data(
        symbol=symbol,
        market_type="spot",
        data_type="klines",
        interval="4h",
        start_date="2024-01-01",
        end_date="2024-01-07"
    )
    print(f"{symbol}: {len(df)} è¡Œæ•°æ®")
```

### åˆ†å—è¯»å–å¤§æ•°æ®é›†

```python
# åˆ†å—è¯»å–ï¼ŒèŠ‚çœå†…å­˜
chunk_generator = manager.read_data(
    symbol="BTCUSDT",
    market_type="spot",
    data_type="klines",
    interval="1m",
    start_date="2024-01-01",
    end_date="2024-01-31",
    chunk_size=10000  # æ¯å—10000è¡Œ
)

for chunk in chunk_generator:
    # å¤„ç†æ¯ä¸ªæ•°æ®å—
    print(f"å¤„ç† {len(chunk)} è¡Œæ•°æ®")
    # åœ¨è¿™é‡Œè¿›è¡Œæ•°æ®åˆ†ææˆ–å¤„ç†
```

### ä¾¿æ·æ–¹æ³•

```python
# è‡ªåŠ¨æ£€æŸ¥æœ¬åœ°æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¸‹è½½
df = manager.download_and_read(
    symbol="ETHUSDT",
    market_type="spot",
    data_type="klines",
    interval="1h",
    start_date="2024-01-01",
    end_date="2024-01-07",
    force_download=False  # å¦‚æœæœ¬åœ°æœ‰æ•°æ®å°±ä¸é‡æ–°ä¸‹è½½
)
```

## æ•°æ®ç»“æ„

### Kçº¿æ•°æ®å­—æ®µ
| å­—æ®µå | è¯´æ˜ |
|--------|------|
| open_time | å¼€ç›˜æ—¶é—´ |
| open | å¼€ç›˜ä»· |
| high | æœ€é«˜ä»· |
| low | æœ€ä½ä»· |
| close | æ”¶ç›˜ä»· |
| volume | æˆäº¤é‡ |
| close_time | æ”¶ç›˜æ—¶é—´ |
| quote_asset_volume | æˆäº¤é¢ |
| number_of_trades | æˆäº¤ç¬”æ•° |
| taker_buy_base_asset_volume | ä¸»åŠ¨ä¹°å…¥æˆäº¤é‡ |
| taker_buy_quote_asset_volume | ä¸»åŠ¨ä¹°å…¥æˆäº¤é¢ |

## æ•°æ®æ¥å£è¯´æ˜

**æ³¨æ„ï¼šä¸åŒå¸‚åœºç±»å‹çš„æ•°æ®ç»“æ„å­˜åœ¨å·®å¼‚ï¼Œè¯·æ ¹æ®å…·ä½“å¸‚åœºç±»å‹ä½¿ç”¨å¯¹åº”çš„å­—æ®µè¯´æ˜ã€‚**

### èšåˆäº¤æ˜“æ•°æ® (Aggregate Trades)

#### ç°è´§å¸‚åœº (SPOT) å’Œ Uæœ¬ä½åˆçº¦ (UM)
- `agg_trade_id`: èšåˆäº¤æ˜“ID
- `price`: ä»·æ ¼
- `quantity`: æ•°é‡
- `first_trade_id`: ç¬¬ä¸€ä¸ªäº¤æ˜“ID
- `last_trade_id`: æœ€åä¸€ä¸ªäº¤æ˜“ID
- `transact_time`: äº¤æ˜“æ—¶é—´ï¼ˆå¾®ç§’æ—¶é—´æˆ³ï¼‰
- `is_buyer_maker`: æ˜¯å¦ä¸ºä¹°æ–¹æŒ‚å•
- `is_best_match`: æ˜¯å¦ä¸ºæœ€ä½³åŒ¹é…ï¼ˆä»…ç°è´§å¸‚åœºæœ‰æ­¤å­—æ®µï¼‰

#### å¸æœ¬ä½åˆçº¦ (CM)
- `agg_trade_id`: èšåˆäº¤æ˜“ID
- `price`: ä»·æ ¼
- `quantity`: æ•°é‡
- `first_trade_id`: ç¬¬ä¸€ä¸ªäº¤æ˜“ID
- `last_trade_id`: æœ€åä¸€ä¸ªäº¤æ˜“ID
- `transact_time`: äº¤æ˜“æ—¶é—´ï¼ˆæ¯«ç§’æ—¶é—´æˆ³ï¼‰
- `is_buyer_maker`: æ˜¯å¦ä¸ºä¹°æ–¹æŒ‚å•
- **æ³¨æ„ï¼šå¸æœ¬ä½åˆçº¦æ²¡æœ‰ `is_best_match` å­—æ®µ**

### äº¤æ˜“æ•°æ® (Trades)

#### ç°è´§å¸‚åœº (SPOT) å’Œ Uæœ¬ä½åˆçº¦ (UM)
- `id`: äº¤æ˜“ID
- `price`: ä»·æ ¼
- `qty`: æ•°é‡
- `quote_qty`: è®¡ä»·è´§å¸æ•°é‡
- `time`: äº¤æ˜“æ—¶é—´ï¼ˆå¾®ç§’æ—¶é—´æˆ³ï¼‰
- `is_buyer_maker`: æ˜¯å¦ä¸ºä¹°æ–¹æŒ‚å•
- `is_best_match`: æ˜¯å¦ä¸ºæœ€ä½³åŒ¹é…ï¼ˆä»…ç°è´§å¸‚åœºæœ‰æ­¤å­—æ®µï¼‰

#### å¸æœ¬ä½åˆçº¦ (CM)
- `id`: äº¤æ˜“ID
- `price`: ä»·æ ¼
- `qty`: æ•°é‡ï¼ˆå¼ æ•°ï¼‰
- `base_qty`: åŸºç¡€è´§å¸æ•°é‡
- `time`: äº¤æ˜“æ—¶é—´ï¼ˆæ¯«ç§’æ—¶é—´æˆ³ï¼‰
- `is_buyer_maker`: æ˜¯å¦ä¸ºä¹°æ–¹æŒ‚å•
- **æ³¨æ„ï¼šå¸æœ¬ä½åˆçº¦ä½¿ç”¨ `base_qty` è€Œé `quote_qty`ï¼Œä¸”æ²¡æœ‰ `is_best_match` å­—æ®µ**

### Kçº¿æ•°æ® (Klines)

#### ç°è´§å¸‚åœº (SPOT)
- `open_time`: å¼€ç›˜æ—¶é—´ï¼ˆå¾®ç§’æ—¶é—´æˆ³ï¼‰
- `open`: å¼€ç›˜ä»·
- `high`: æœ€é«˜ä»·
- `low`: æœ€ä½ä»·
- `close`: æ”¶ç›˜ä»·
- `volume`: æˆäº¤é‡
- `close_time`: æ”¶ç›˜æ—¶é—´ï¼ˆå¾®ç§’æ—¶é—´æˆ³ï¼‰
- `quote_volume`: è®¡ä»·è´§å¸æˆäº¤é‡
- `count`: æˆäº¤ç¬”æ•°
- `taker_buy_volume`: ä¸»åŠ¨ä¹°å…¥æˆäº¤é‡
- `taker_buy_quote_volume`: ä¸»åŠ¨ä¹°å…¥è®¡ä»·è´§å¸æˆäº¤é‡
- `ignore`: å¿½ç•¥å­—æ®µ

#### Uæœ¬ä½åˆçº¦ (UM) å’Œ å¸æœ¬ä½åˆçº¦ (CM)
- `open_time`: å¼€ç›˜æ—¶é—´ï¼ˆæ¯«ç§’æ—¶é—´æˆ³ï¼‰
- `open`: å¼€ç›˜ä»·
- `high`: æœ€é«˜ä»·
- `low`: æœ€ä½ä»·
- `close`: æ”¶ç›˜ä»·
- `volume`: æˆäº¤é‡
- `close_time`: æ”¶ç›˜æ—¶é—´ï¼ˆæ¯«ç§’æ—¶é—´æˆ³ï¼‰
- `quote_volume`: è®¡ä»·è´§å¸æˆäº¤é‡
- `count`: æˆäº¤ç¬”æ•°
- `taker_buy_volume`: ä¸»åŠ¨ä¹°å…¥æˆäº¤é‡
- `taker_buy_quote_volume`: ä¸»åŠ¨ä¹°å…¥è®¡ä»·è´§å¸æˆäº¤é‡
- `ignore`: å¿½ç•¥å­—æ®µ

**æ—¶é—´æˆ³è¯´æ˜ï¼š**
- ç°è´§å¸‚åœºä½¿ç”¨å¾®ç§’æ—¶é—´æˆ³ï¼ˆ16ä½æ•°å­—ï¼‰
- åˆçº¦å¸‚åœºä½¿ç”¨æ¯«ç§’æ—¶é—´æˆ³ï¼ˆ13ä½æ•°å­—ï¼‰

## æ–‡ä»¶ç»“æ„

```
binance_trading_system/
â”œâ”€â”€ config.py                    # é…ç½®æ–‡ä»¶
â”œâ”€â”€ data_downloader.py           # æ•°æ®ä¸‹è½½å™¨
â”œâ”€â”€ data_reader.py               # æ•°æ®è¯»å–å™¨
â”œâ”€â”€ historical_data_manager.py   # å†å²æ•°æ®ç®¡ç†å™¨
â”œâ”€â”€ example_usage.py             # ä½¿ç”¨ç¤ºä¾‹
â”œâ”€â”€ test_system.py               # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ requirements.txt             # ä¾èµ–åŒ…
â”œâ”€â”€ README.md                    # è¯´æ˜æ–‡æ¡£
â””â”€â”€ data/                        # æ•°æ®å­˜å‚¨ç›®å½•
    â”œâ”€â”€ spot/                    # ç°è´§æ•°æ®
    â”‚   â”œâ”€â”€ monthly/             # æœˆåº¦æ•°æ®
    â”‚   â”‚   â”œâ”€â”€ klines/
    â”‚   â”‚   â”œâ”€â”€ trades/
    â”‚   â”‚   â””â”€â”€ aggTrades/
    â”‚   â””â”€â”€ daily/               # æ—¥åº¦æ•°æ®
    â”‚       â”œâ”€â”€ klines/
    â”‚       â”œâ”€â”€ trades/
    â”‚       â””â”€â”€ aggTrades/
    â”œâ”€â”€ um/                      # USD-MæœŸè´§æ•°æ®
    â””â”€â”€ cm/                      # COIN-MæœŸè´§æ•°æ®
```

## é«˜çº§åŠŸèƒ½

### æ•°æ®ä¿¡æ¯æŸ¥è¯¢

```python
# è·å–æ•°æ®ä¿¡æ¯
info = manager.get_data_info(
    symbol="BTCUSDT",
    market_type="spot",
    data_type="klines",
    interval="1h"
)
print(info)

# è·å–æœ¬åœ°äº¤æ˜“å¯¹åˆ—è¡¨
local_symbols = manager.get_local_symbols("spot", "klines")
print(f"æœ¬åœ°äº¤æ˜“å¯¹: {local_symbols}")

# è·å–å­˜å‚¨ç»Ÿè®¡
stats = manager.get_storage_stats()
print(f"æ€»å¤§å°: {stats['total_size_mb']} MB")
print(f"æ€»æ–‡ä»¶æ•°: {stats['total_files']}")
```

### æ•°æ®æ¸…ç†

```python
# æ¸…ç†30å¤©å‰çš„æ•°æ®
deleted_count = manager.cleanup_old_data(days_to_keep=30)
print(f"åˆ é™¤äº† {deleted_count} ä¸ªæ–‡ä»¶")
```

## è¿è¡Œç¤ºä¾‹

```bash
# è¿è¡Œä½¿ç”¨ç¤ºä¾‹
python example_usage.py

# è¿è¡Œæµ‹è¯•
python test_system.py
```

## é…ç½®è¯´æ˜

å¯ä»¥é€šè¿‡ä¿®æ”¹ `config.py` æ–‡ä»¶æ¥è‡ªå®šä¹‰é…ç½®ï¼š

```python
# ä¿®æ”¹é»˜è®¤é…ç½®
DEFAULT_CONFIG = {
    "data_directory": "/path/to/your/data",  # è‡ªå®šä¹‰æ•°æ®ç›®å½•
    "market_type": "spot",
    "data_type": "klines",
    "interval": "1h",
    "start_date": "2020-01-01",
    "symbols": ["BTCUSDT", "ETHUSDT"],
    # ... å…¶ä»–é…ç½®
}
```

## æ³¨æ„äº‹é¡¹

1. **ç½‘ç»œè¦æ±‚**: æ•°æ®ä¸‹è½½éœ€è¦ç¨³å®šçš„ç½‘ç»œè¿æ¥
2. **å­˜å‚¨ç©ºé—´**: å†å²æ•°æ®æ–‡ä»¶è¾ƒå¤§ï¼Œè¯·ç¡®ä¿æœ‰è¶³å¤Ÿçš„å­˜å‚¨ç©ºé—´
3. **ä¸‹è½½é™åˆ¶**: å¸å®‰å¯¹æ•°æ®ä¸‹è½½æœ‰ä¸€å®šçš„é¢‘ç‡é™åˆ¶ï¼Œå»ºè®®åˆç†å®‰æ’ä¸‹è½½ä»»åŠ¡
4. **æ•°æ®å®Œæ•´æ€§**: æŸäº›å†å²æ•°æ®å¯èƒ½ä¸å®Œæ•´æˆ–ç¼ºå¤±ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è·³è¿‡æ— æ•ˆæ–‡ä»¶

## é”™è¯¯å¤„ç†

ç³»ç»ŸåŒ…å«å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼š
- ç½‘ç»œé”™è¯¯æ—¶ä¼šè‡ªåŠ¨é‡è¯•
- æ–‡ä»¶æŸåæ—¶ä¼šè·³è¿‡å¹¶ç»§ç»­å¤„ç†
- å‚æ•°é”™è¯¯æ—¶ä¼šç»™å‡ºæ˜ç¡®çš„é”™è¯¯ä¿¡æ¯

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ‰¹é‡ä¸‹è½½**: ä¸€æ¬¡ä¸‹è½½å¤šä¸ªäº¤æ˜“å¯¹æ¯”å•ç‹¬ä¸‹è½½æ›´é«˜æ•ˆ
2. **åˆ†å—è¯»å–**: å¯¹äºå¤§æ•°æ®é›†ä½¿ç”¨åˆ†å—è¯»å–é¿å…å†…å­˜æº¢å‡º
3. **æœ¬åœ°ç¼“å­˜**: å……åˆ†åˆ©ç”¨æœ¬åœ°å·²ä¸‹è½½çš„æ•°æ®ï¼Œé¿å…é‡å¤ä¸‹è½½
4. **å¹¶è¡Œå¤„ç†**: å¯ä»¥è€ƒè™‘ä½¿ç”¨å¤šçº¿ç¨‹æˆ–å¤šè¿›ç¨‹æ¥åŠ é€Ÿæ•°æ®å¤„ç†

## åç»­ç‰ˆæœ¬è§„åˆ’

- [ ] å®æ—¶æ•°æ®æ¥å£
- [ ] æŠ€æœ¯æŒ‡æ ‡è®¡ç®—
- [ ] æ•°æ®å¯è§†åŒ–
- [ ] ç­–ç•¥å›æµ‹æ¡†æ¶
- [ ] é£é™©ç®¡ç†æ¨¡å—
- [ ] å®ç›˜äº¤æ˜“æ¥å£

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ã€‚

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ã€‚